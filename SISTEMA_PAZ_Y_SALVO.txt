// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRUEBA COMPLETA - SISTEMA PAZ Y SALVO
// NGS&O CRM GestiÃ³n de Cobranza
// Desarrollado por: Alejandro Sandoval - AS Software
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                           â•‘
â•‘      ğŸ‰ SISTEMA PAZ Y SALVO IMPLEMENTADO                 â•‘
â•‘      CRM NGS&O - GestiÃ³n de Cobranza                     â•‘
â•‘                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… COMPONENTES IMPLEMENTADOS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ BACKEND:

1. ENTIDADES (TypeORM):
   â”œâ”€ ClientPhoneNumber
   â”‚  â”œâ”€ MÃºltiples nÃºmeros de WhatsApp por cliente
   â”‚  â”œâ”€ Marca nÃºmero principal (isPrimary)
   â”‚  â”œâ”€ Registro de Ãºltimo contacto
   â”‚  â””â”€ Ãndices optimizados para bÃºsquedas
   â”‚
   â””â”€ PazYSalvo
      â”œâ”€ NÃºmero de certificado Ãºnico (PYS-XXXXXXXXXX)
      â”œâ”€ Estado: PENDING â†’ AVAILABLE â†’ DOWNLOADED
      â”œâ”€ Fecha de pago + 5 dÃ­as hÃ¡biles
      â””â”€ Trazabilidad completa (quiÃ©n generÃ³/descargÃ³)

2. SERVICIOS:
   â”œâ”€ ClientIdentificationService
   â”‚  â”œâ”€ identifyClientByDocument(documento, telefono)
   â”‚  â”œâ”€ findClientByPhone(telefono)
   â”‚  â”œâ”€ getClientPhoneNumbers(clientId)
   â”‚  â””â”€ calculateBusinessDays() - DÃ­as hÃ¡biles colombianos
   â”‚
   â””â”€ PazYSalvoService
      â”œâ”€ createPazYSalvo() - CreaciÃ³n automÃ¡tica
      â”œâ”€ checkAvailability() - Verificar dÃ­as restantes
      â”œâ”€ generatePDF() - Certificado profesional
      â””â”€ registerDownload() - Control de descargas

3. API REST (paz-y-salvo):
   â”œâ”€ GET  /check/:clientId
   â”‚  â””â”€ Verifica disponibilidad (5 dÃ­as hÃ¡biles)
   â”œâ”€ GET  /client/:clientId
   â”‚  â””â”€ Obtiene info del certificado
   â”œâ”€ GET  /download/:clientId
   â”‚  â””â”€ Descarga PDF si disponible
   â””â”€ POST /create/:clientId
      â””â”€ CreaciÃ³n manual (Admin/Supervisor)

4. LÃ“GICA DE NEGOCIO:
   â”œâ”€ Auto-creaciÃ³n cuando cliente paga
   â”œâ”€ CÃ¡lculo automÃ¡tico de 5 dÃ­as hÃ¡biles
   â”œâ”€ Excluye fines de semana
   â”œâ”€ Excluye 17 festivos colombianos 2025-2026
   â””â”€ PDF profesional con datos completos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’» FRONTEND:

1. ChatMessages.tsx - IntegraciÃ³n en Chat:
   â”œâ”€ BotÃ³n "Descargar Paz y Salvo"
   â”‚  â”œâ”€ Visible solo si cliente estÃ¡ PAID
   â”‚  â”œâ”€ Verde si disponible (â‰¥5 dÃ­as)
   â”‚  â””â”€ Amarillo con countdown si pendiente
   â”‚
   â”œâ”€ VerificaciÃ³n automÃ¡tica al abrir chat
   â”œâ”€ Tooltip con mensaje de estado
   â””â”€ Descarga directa con nombre personalizado

2. ESTADOS VISUALES:
   â”œâ”€ ğŸŸ¢ DISPONIBLE - "Descargar Paz y Salvo"
   â”œâ”€ ğŸŸ¡ PENDIENTE - "Disponible en X dÃ­a(s)"
   â””â”€ âš« NO APLICA - Sin botÃ³n (no pagado)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ—„ï¸ BASE DE DATOS:

1. TABLA: client_phone_numbers
   â”œâ”€ Migrados: 17 registros iniciales
   â”œâ”€ Ãndices: [clientId, phoneNumber], phoneNumber
   â””â”€ Triggers: Auto-update timestamp

2. TABLA: paz_y_salvos
   â”œâ”€ Registros: 2 certificados creados
   â”œâ”€ Ãndices: clientId, status, availableFromDate
   â””â”€ Constraints: certificateNumber UNIQUE

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ FLUJO COMPLETO:

1ï¸âƒ£  Cliente realiza pago
    â†“
2ï¸âƒ£  Agente marca como "PAID" en CRM
    â†“
3ï¸âƒ£  Sistema crea PazYSalvo automÃ¡ticamente
    â”‚   - certificateNumber: PYS-XXXXXXXXXX
    â”‚   - paymentDate: FECHA_PAGO
    â”‚   - availableFromDate: FECHA_PAGO + 5 dÃ­as hÃ¡biles
    â”‚   - status: PENDING
    â†“
4ï¸âƒ£  Transcurren 5 dÃ­as hÃ¡biles
    â”‚   (Excluye fines de semana + festivos)
    â†“
5ï¸âƒ£  Sistema actualiza status â†’ AVAILABLE
    â†“
6ï¸âƒ£  Cliente abre chat en WhatsApp
    â†“
7ï¸âƒ£  Frontend verifica disponibilidad
    â”‚   GET /paz-y-salvo/check/:clientId
    â†“
8ï¸âƒ£  Muestra botÃ³n verde "Descargar Paz y Salvo"
    â†“
9ï¸âƒ£  Cliente/Agente hace clic
    â†“
ğŸ”Ÿ  Backend genera PDF si no existe
    â”‚   - Encabezado profesional
    â”‚   - Datos del cliente
    â”‚   - Monto pagado con formato
    â”‚   - DeclaraciÃ³n oficial
    â”‚   - Fecha expediciÃ³n Colombia
    â†“
1ï¸âƒ£1ï¸âƒ£ Descarga archivo:
    â”‚   Paz-y-Salvo-NOMBRE-CLIENTE.pdf
    â†“
1ï¸âƒ£2ï¸âƒ£ Sistema registra descarga
    â”‚   - status â†’ DOWNLOADED
    â”‚   - downloadedBy: userId
    â”‚   - downloadedAt: TIMESTAMP

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“… CÃLCULO DÃAS HÃBILES (Colombia 2025-2026):

Festivos excluidos:
â”œâ”€ 2025-01-01 - AÃ±o Nuevo
â”œâ”€ 2025-01-06 - Reyes Magos
â”œâ”€ 2025-03-24 - San JosÃ©
â”œâ”€ 2025-04-17 - Jueves Santo
â”œâ”€ 2025-04-18 - Viernes Santo
â”œâ”€ 2025-05-01 - DÃ­a del Trabajo
â”œâ”€ 2025-06-02 - AscensiÃ³n
â”œâ”€ 2025-06-23 - Corpus Christi
â”œâ”€ 2025-06-30 - Sagrado CorazÃ³n
â”œâ”€ 2025-07-20 - Independencia
â”œâ”€ 2025-08-07 - Batalla de BoyacÃ¡
â”œâ”€ 2025-08-18 - AsunciÃ³n
â”œâ”€ 2025-10-13 - DÃ­a de la Raza
â”œâ”€ 2025-11-03 - Todos los Santos
â”œâ”€ 2025-11-17 - Independencia Cartagena
â”œâ”€ 2025-12-08 - Inmaculada ConcepciÃ³n
â””â”€ 2025-12-25 - Navidad

Ejemplo:
  Pago: Lunes 25/11/2025
  â†’ Martes 26 (dÃ­a 1)
  â†’ MiÃ©rcoles 27 (dÃ­a 2)
  â†’ Jueves 28 (dÃ­a 3)
  â†’ Viernes 29 (dÃ­a 4)
  â†’ [SÃ¡b-Dom: NO CUENTAN]
  â†’ Lunes 2/12 (dÃ­a 5) âœ… DISPONIBLE

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” SEGURIDAD Y PERMISOS:

â”œâ”€ Todos los endpoints protegidos con JWT
â”œâ”€ Permisos requeridos: clients:read, clients:update
â”œâ”€ Solo descarga si cliente estÃ¡ en estado PAID
â”œâ”€ ValidaciÃ³n de disponibilidad (5 dÃ­as hÃ¡biles)
â””â”€ Trazabilidad completa de generaciÃ³n/descarga

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“„ FORMATO PDF GENERADO:

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                        â•‘
â•‘        CERTIFICADO DE PAZ Y SALVO                      â•‘
â•‘        Certificado No. PYS-XXXXXXXXXX                  â•‘
â•‘                                                        â•‘
â•‘  DATOS DEL CLIENTE                                     â•‘
â•‘  Nombre: [Nombre Completo]                             â•‘
â•‘  Documento: [CÃ©dula]                                   â•‘
â•‘  TelÃ©fono: [WhatsApp]                                  â•‘
â•‘                                                        â•‘
â•‘  INFORMACIÃ“N DEL PAGO                                  â•‘
â•‘  Monto Pagado: $X.XXX.XXX COP                          â•‘
â•‘  Fecha de Pago: DD de MMMM de YYYY                     â•‘
â•‘  Deuda Original: $X.XXX.XXX COP                        â•‘
â•‘                                                        â•‘
â•‘  DECLARACIÃ“N                                           â•‘
â•‘  Por medio del presente documento, certificamos        â•‘
â•‘  que [CLIENTE] identificado(a) con documento de        â•‘
â•‘  identidad No. [DOCUMENTO], se encuentra a PAZ Y       â•‘
â•‘  SALVO con nuestra entidad por concepto de            â•‘
â•‘  obligaciones financieras.                            â•‘
â•‘                                                        â•‘
â•‘  El cliente ha cancelado satisfactoriamente la        â•‘
â•‘  totalidad de su deuda por un valor de $X.XXX.XXX,   â•‘
â•‘  quedando sin ningÃºn saldo pendiente.                 â•‘
â•‘                                                        â•‘
â•‘  Fecha de expediciÃ³n: DD de MMMM de YYYY              â•‘
â•‘                                                        â•‘
â•‘  _________________________________                     â•‘
â•‘  Firma Autorizada                                     â•‘
â•‘  NGS&O - Sistema CRM                                  â•‘
â•‘                                                        â•‘
â•‘  Este documento es vÃ¡lido sin necesidad de firma      â•‘
â•‘  manuscrita. Puede ser verificado con el nÃºmero       â•‘
â•‘  de certificado.                                      â•‘
â•‘                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ§ª SCRIPTS DE PRUEBA DISPONIBLES:

â”œâ”€ test-paz-y-salvo-system.js
â”‚  â””â”€ VerificaciÃ³n completa del sistema
â”œâ”€ create-paz-y-salvos.js
â”‚  â””â”€ Crear certificados para clientes pagados
â”œâ”€ run-paz-y-salvo-migration.js
â”‚  â””â”€ Ejecutar migraciones SQL
â””â”€ clean-paz-y-salvo.js
   â””â”€ Limpiar registros invÃ¡lidos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ESTADO ACTUAL:

âœ… Tablas creadas y migradas
âœ… 2 certificados generados (Alejandro Sandoval + otro)
âœ… 17 telÃ©fonos migrados a client_phone_numbers
âœ… Backend compilado sin errores
âœ… Frontend integrado con botÃ³n condicional
âœ… LÃ³gica de dÃ­as hÃ¡biles funcionando
âœ… PDF profesional con formato Colombia

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸš€ PRÃ“XIMOS PASOS:

1. Reiniciar backend para activar nuevos endpoints
2. Probar descarga desde frontend
3. Validar cÃ¡lculo de dÃ­as hÃ¡biles en producciÃ³n
4. Opcional: Integrar firma digital en PDF
5. Opcional: EnvÃ­o automÃ¡tico por email/WhatsApp

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Para iniciar el backend:
  cd backend
  npm run start:dev

Para iniciar el frontend:
  cd frontend
  npm run dev

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ SISTEMA COMPLETO Y OPERACIONAL âœ¨

Desarrollado con ğŸ’™ por AS Software
`);
